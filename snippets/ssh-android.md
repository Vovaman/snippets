# Доступ к android-устройству по ssh
Необходимо скачивать с android-устройства (или закачивать на него) файлы без usb-шнура с PC под управлением Ubuntu.  
Для этого нужно организовать доступ к  по SSH.  
Источник: https://wiki.termux.com/wiki/Remote_Access  
Устанавливаем на android-устройстве приложение termux и даём этому приложению в настройках все права.
Далее шаги описаны в исходнике ниже. Предполагается, что мы выполняем их на android-устройстве в запущенном приложении termux.
Если команды выполняются на PC, то они даются в комментариях.

**Важное замечание!**
На смартфонах и планшетах довольно сложные настройки энергосбережения.
В моем случае (планшет Huawei) связь по ssh сразу рвалась, когда
начинал темнеть экран или приложение termux выполнялось в фоновом режиме.
В этом случае в консоли ноута рвется связь и появляется ошибка "broken pipe".
В конечном итоге пришлось выключить отключение экрана и для доступа к планшету держу
активным приложение termux.

```bash
$ apt update
$ apt upgrade

# ставим openssh-server
$ apt install openssh

# даём доступ к хранилищам
$ termux-setup-storage

# задаём пароль для доступа к устройству (пароль вводим дважды)
$ passwd

# запустим openssh-server
$ sshd

# теперь со своего PC можно получить доступ к android-устройству по SSH
# следующей командой (по умолчанию порт - 8022):
# ssh -p 8022 <android device IP>
# <android device IP> меняем на реальный IP устройства, узнать который можно,
# запустив в termux команду 
# ip a
# в процессе выполнения команды будет запрошен пароль для текущего пользователя
# под которым мы работаем на PC
# вводим тот пароль, который задавали выше

# если парольной аутентификации достаточно, то на этом настройку можно закончить
# ...
# для доступа по ssh необходимо запустить termux и в нём выполнить команду
$ sshd

# к примеру, доступ к файлам с камеры можно получить в каталоге:
# ~/storage/dcim/Camera

# далее допустим, что, ради повышения уровня безопасности,
# мы хотим организовать SSH-доступ по ключу, а не по паролю
# для этого будем использовать специально сгенерированный ключ
# выполняем на своем PC команды:
# cd ~/.ssh
# ssh-keygen -t rsa -b 4096 -C "<your_email>" -f <key_file_name>
# в команде выше вписываем почтовый адрес и имя файла ключа
# копируем публичный ключ на android-устройство:
# ssh-copy-id -p 8022 -i <key_file_name> <android device IP>

# после успешного выполнения предыдущей команды выключаем аутентификацию
# по паролю:
$ nano $PREFIX/etc/ssh/sshd_config

# редактируем строку:
# PasswordAuthentication no
# после сохранения файла выполняем команды:
$ pkill sshd
$ sshd

# теперь можно получать ssh-доступ к android-устройству по ключу
# для этого необходимо: 
# запустить на android-устройстве termux, выполнить на нем команду
$ sshd

# после этого выполняем на PC команду:
# ssh -p 8022 -i ~/.ssh/<key_file_name> <android device IP>
# важное замечание: прописывание файла ключа в ~/.ssh/config не помогает,
# его явно нужно прописывать в команде
```